(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{193:function(r,e,a){"use strict";a.r(e);var o=a(0),t=Object(o.a)({},function(){var r=this,e=r.$createElement,a=r._self._c||e;return a("div",{staticClass:"content"},[r._m(0),r._v(" "),a("blockquote",[a("p",[r._v("原文"),a("a",{attrs:{href:"https://pietrowski.info/2008/09/how-to-extend-sqlerrorcodesfactory/",target:"_blank",rel:"noopener noreferrer"}},[r._v("https://pietrowski.info/2008/09/how-to-extend-sqlerrorcodesfactory/"),a("OutboundLink")],1)])]),r._v(" "),a("p",[r._v("我在spring框架中发现了一些有趣的功能。Spring为你提供了将sql错误代码映射到异常类型的功能。默认情况下，spring框架分发文件中有一个名为sql-error-codes.xml的文件，它为常用数据库（DB2，Derby，H2，HSQL，Informix，MS-SQL，MySQL，Oracle，PostgreSQL，Sybase）定义。")]),r._v(" "),a("p",[r._v("此键采取"),a("a",{attrs:{href:"https://docs.oracle.com/javase/6/docs/api/java/sql/DatabaseMetaData.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("java.sql.DatabaseMetaData"),a("OutboundLink")],1),r._v(" "),a("a",{attrs:{href:"https://docs.oracle.com/javase/6/docs/api/java/sql/DatabaseMetaData.html#getDatabaseProductName()",target:"_blank",rel:"noopener noreferrer"}},[r._v("databaseProductName"),a("OutboundLink")],1),r._v("属性。每个驱动都应提供适当的实施。本文将为您提供如何添加其他数据库或扩展定义到更多SQL代码的方式。")]),r._v(" "),a("p",[r._v('在我们阅读java文档时，默认文件捆绑在spring.jar中，位于“ org/springframework/jdbc/support/sql-error-codes.xml" 。所以第一个解决方案是简单地提取这个文件，添加我们想要的，然后放回去。这个解决方案有很多缺点，例如当我们升级时，我们必须再次重复我们的步骤。如果我们继续阅读java文档，当读到——')]),r._v(" "),a("p",[r._v("如果未被类路径根目录中的文件覆盖（例如在“/ WEB-INF / classes”目录中），则读取此包中的默认文件。")]),r._v(" "),a("p",[r._v("第二种选择是在根路径中提供名为'sql-error-codes.xml'的文件。让我们开始编码。")]),r._v(" "),a("p",[r._v("我们的App.java非常简单。")]),r._v(" "),r._m(1),r._v(" "),r._m(2),r._v(" "),a("p",[r._v("如果我们在调试模式下运行，我们可以看到类似这样的东西。这是MySQL数据库默认的SQL错误代码定义。现在我们添加'sql-error-codes.xml'文件。我刚刚从默认文件中复制了MySQL bean，并向badSqlGrammarCodes添加了一些代码。这次结果如下所示：")]),r._v(" "),r._m(3),r._v(" "),a("p",[r._v("这里是执行日志，有趣的加粗行：")]),r._v(" "),r._m(4),a("p",[r._v("要记住的一点是，我们的定义并没有覆盖所有的定义，而只覆盖了具有相同bean id的定义。这在"),a("a",{attrs:{href:"https://docs.spring.io/spring/docs/2.5.x/javadoc-api/org/springframework/jdbc/support/SQLErrorCodesFactory.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("SQLErrorCodesFactory javadoc"),a("OutboundLink")],1),r._v("中并不明显, 它意味我们覆盖了所有的bean。")]),r._v(" "),a("p",[r._v("如果我们有不同的数据库，或者我们想要扩展或更改SQL代码映射为异常，我们可以使用这种机制。该应用程序非常简单，但你可以"),a("a",{attrs:{href:"http://pietrowski.info/wp-content/uploads/2008/09/sqlerrorcode.tgz",target:"_blank",rel:"noopener noreferrer"}},[r._v("下载它，并自己尝试"),a("OutboundLink")],1),r._v("。")]),r._v(" "),a("p",[r._v("第一次翻译，读顺不容易~")])])},[function(){var r=this.$createElement,e=this._self._c||r;return e("h1",{attrs:{id:"译-如何扩展sqlerrorcodesfactory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#译-如何扩展sqlerrorcodesfactory","aria-hidden":"true"}},[this._v("#")]),this._v(" 译-如何扩展SQLErrorCodesFactory")])},function(){var r=this.$createElement,e=this._self._c||r;return e("pre",[e("code",[this._v("public class App { \n\n    public static void main（String [] args）{ \n\n        SQLErrorCodesFactory errorCodes = SQLErrorCodesFactory.getInstance（）; \n\n        SQLErrorCodes errorCode = errorCodes.getErrorCodes（“MySQL”）; \n\n    } \n\n}\n")])])},function(){var r=this.$createElement,e=this._self._c||r;return e("p",[e("img",{attrs:{src:"/mydairy/img/fy1.png",alt:""}})])},function(){var r=this.$createElement,e=this._self._c||r;return e("p",[e("img",{attrs:{src:"/mydairy/img/fy2.png",alt:""}})])},function(){var r=this.$createElement,e=this._self._c||r;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Sep 2, 2008 9:54:46 PM \n\norg.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions\n\nINFO: Loading XML bean definitions from class path resource [org/springframework/jdbc/support/sql-error-codes.xml]\n\nSep 2, 2008 9:54:46 PM \n\norg.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions\n\n**INFO: Loading XML bean definitions from class path resource [sql-error-codes.xml]**\n\n**Sep 2, 2008 9:54:46 PM**\n\n**org.springframework.beans.factory.support.DefaultListableBeanFactory registerBeanDefinition**\n\n**INFO: Overriding bean definition for bean 'MySQL': replacing [Generic bean: ... defined in class path resource [org/springframework/jdbc/support/sql-error-codes.xml]] with [Generic bean: ... defined in class path resource [sql-error-codes.xml]]**\n\n**Sep 2, 2008 9:54:46 PM org.springframework.jdbc.support.SQLErrorCodesFactory**\n\n**INFO: Found custom sql-error-codes.xml file at the root of the classpath**\n\nSep 2, 2008 9:54:46 PM org.springframework.jdbc.support.SQLErrorCodesFactory \n\nINFO: SQLErrorCodes loaded: [DB2, Derby, H2, HSQL, Informix, MS-SQL, MySQL, Oracle, PostgreSQL, Sybase]\n")])])])}],!1,null,null,null);e.default=t.exports}}]);